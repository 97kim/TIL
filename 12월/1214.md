<code>ëŒ“ê¸€ inputì— scriptë¬¸ì„ ë„£ìœ¼ë©´ ì–´ë–»ê²Œ ë ê¹Œ?</code>ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤. ê·¸ë˜ì„œ ë°”ë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì•˜ë‹¤.

![](https://images.velog.io/images/rudwnd33/post/bfd0d88e-50a9-4f89-848b-518b11b48411/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-12-14%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.34.10.png)

ì—­ì‹œëŠ” ì—­ì‹œë‹¤. scriptë¬¸ì´ ì•„ì£¼ ì˜ ì ìš©ëœë‹¤!

![](https://images.velog.io/images/rudwnd33/post/3ca121e0-bff6-4609-82bc-5897be5b6213/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-12-14%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.34.58.png)

```
<script>alert('hi')</script>
```
ìœ„ ì½”ë“œë¥¼ inputì— ë„£ê³  ì €ì¥ì„ í–ˆì„ ë•Œ <, > ì™€ ê°™ì€ íŠ¹ìˆ˜ë¬¸ìë“¤ì´ ê·¸ëŒ€ë¡œ ì „ì†¡ì´ ë˜ì–´ì„œ ê·¸ë ‡ë‹¤.
ì´ëŸ° XSS ì´ìŠˆë¥¼ ë§‰ì•„ë†“ì§€ ì•ŠëŠ”ë‹¤ë©´ ë³´ì•ˆìƒ ìœ„í—˜í•˜ê¸° ë•Œë¬¸ì— ë§‰ì•„ì•¼í•œë‹¤!

![](https://images.velog.io/images/rudwnd33/post/1e3845dd-923b-4229-98cc-b4c1efa0ff74/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-12-14%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.35.55.png)

í˜¹ì‹œ ëª°ë¼ì„œ html íƒœê·¸ë“¤ë„ ë„£ì–´ë´¤ì§€ë§Œ ì•„ì£¼ ì˜ ì ìš©ëœë‹¤! ğŸ¤£

![](https://images.velog.io/images/rudwnd33/post/e555cf50-e7ca-44e3-869e-8b9c801a20bb/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-12-14%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.36.17.png)

ë‹¤ë¥¸ íŒ€ë“¤ í”„ë¡œì íŠ¸ì—ë„ í•´ë´¤ëŠ”ë° ì ìš©ì´ ì˜ ë˜ì—ˆë‹¤. ë‹¤ë“¤ ëª¨ë¥´ê³  ê³„ì…”ì„œ ì•Œë ¤ë“œë ¸ë‹¤. ë¿Œë“¯í•˜ë‹¤. ã…ã…

<code>**XSS(cross-site scripting)**</code>ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë§ì´ ë‚˜íƒ€ë‚˜ëŠ” ì·¨ì•½ì ì˜ í•˜ë‚˜ë¡œ ì›¹ì‚¬ì´íŠ¸ ê´€ë¦¬ìê°€ ì•„ë‹Œ ì´ê°€ ì›¹ í˜ì´ì§€ì— ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ë‹¤. ì£¼ë¡œ ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë³´ê²Œ ë˜ëŠ” ì „ì ê²Œì‹œíŒì— ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ê°€ ë‹´ê¸´ ê¸€ì„ ì˜¬ë¦¬ëŠ” í˜•íƒœë¡œ ì´ë£¨ì–´ì§„ë‹¤. ì´ ì·¨ì•½ì ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©ìë¡œë¶€í„° ì…ë ¥ ë°›ì€ ê°’ì„ ì œëŒ€ë¡œ ê²€ì‚¬í•˜ì§€ ì•Šê³  ì‚¬ìš©í•  ê²½ìš° ë‚˜íƒ€ë‚œë‹¤. ì´ ì·¨ì•½ì ìœ¼ë¡œ í•´ì»¤ê°€ ì‚¬ìš©ìì˜ ì •ë³´(ì¿ í‚¤, ì„¸ì…˜ ë“±)ë¥¼ íƒˆì·¨í•˜ê±°ë‚˜, ìë™ìœ¼ë¡œ ë¹„ì •ìƒì ì¸ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤. ì£¼ë¡œ ë‹¤ë¥¸ ì›¹ì‚¬ì´íŠ¸ì™€ ì •ë³´ë¥¼ êµí™˜í•˜ëŠ” ì‹ìœ¼ë¡œ ì‘ë™í•˜ë¯€ë¡œ ì‚¬ì´íŠ¸ ê°„ ìŠ¤í¬ë¦½íŒ…ì´ë¼ê³  í•œë‹¤.

> **ì°¸ê³ **
https://ko.wikipedia.org/wiki/%EC%82%AC%EC%9D%B4%ED%8A%B8_%EA%B0%84_%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8C%85

ìŠ¤í”„ë§ì—ì„œ XSSë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•ì´ ìˆì„ê¹Œ ì°¾ì•„ë³´ë˜ ë„ì¤‘ response ê²°ê³¼ë¡œ íŠ¹ì • ë¬¸ìë¥¼ Escape ì²˜ë¦¬ë˜ê²Œ í•˜ëŠ” ë°©ë²•ì„ ë°œê²¬í–ˆë‹¤.

### 1. <code>build.gradle</code>ì˜ dependenciesì— ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•œë‹¤.
```
implementation 'org.apache.commons:commons-text:1.9'
```
<code>Apache Commons Text</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë¬¸ìì—´ì—ì„œ ì‘ë™í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì— ì¤‘ì ì„ ë‘” ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ìµœì‹  ì•ˆì • ë¦´ë¦¬ìŠ¤ëŠ” 1.9 ë²„ì „ì´ë¯€ë¡œ 1.9 ë²„ì „ì„ ì‚¬ìš©í•œë‹¤.

### 2. <code>HTMLCharacterEscapes</code> í´ë˜ìŠ¤ ìƒì„±í•œë‹¤.
```
public class HtmlCharacterEscapes extends CharacterEscapes {

    private final int[] asciiEscapes;

    public HtmlCharacterEscapes() {
        // XSSë¥¼ ë°©ì§€í•  íŠ¹ìˆ˜ ë¬¸ì ì§€ì •
        asciiEscapes = CharacterEscapes.standardAsciiEscapesForJSON();
        asciiEscapes['<'] = CharacterEscapes.ESCAPE_CUSTOM;
        asciiEscapes['>'] = CharacterEscapes.ESCAPE_CUSTOM;
        asciiEscapes['\"'] = CharacterEscapes.ESCAPE_CUSTOM;
        asciiEscapes['('] = CharacterEscapes.ESCAPE_CUSTOM;
        asciiEscapes[')'] = CharacterEscapes.ESCAPE_CUSTOM;
        asciiEscapes['#'] = CharacterEscapes.ESCAPE_CUSTOM;
        asciiEscapes['\''] = CharacterEscapes.ESCAPE_CUSTOM;
    }

    @Override
    public int[] getEscapeCodesForAscii() {
        // ìœ ë‹ˆì½”ë“œ(ASCII ë¬¸ì)ì˜ ì²˜ìŒ 128ìì— ëŒ€í•œ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ë¥¼ ê²°ì •í•˜ê¸° ìœ„í•´ í˜¸ì¶œ
        return asciiEscapes;
    }

    @Override
    public SerializableString getEscapeSequence(int ch) {
        // íŠ¹ì • ë¬¸ìì— ì‚¬ìš©í•  ì´ìŠ¤ì¼€ì´í”„ ì‹œí€€ìŠ¤ë¥¼ ê²°ì •í•˜ê¸° ìœ„í•´ í˜¸ì¶œ
        return new SerializedString(StringEscapeUtils.escapeHtml4(Character.toString((char) ch)));
    }
}
```

### 3. WebMvcConfigurer ì¸í„°í˜ì´ìŠ¤ ìƒì† ë°›ì•„ MappingJackson2HttpMessageConverterë¥¼ ì¬ì •ì˜í•œë‹¤.
```
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {

    @Bean
    public MappingJackson2HttpMessageConverter jsonEscapeConverter() {
        // MappingJackson2HttpMessageConverter Default ObjectMapper ì„¤ì • ë° ObjectMapper Config ì„¤ì •
        ObjectMapper objectMapper = Jackson2ObjectMapperBuilder.json().build();
        objectMapper.getFactory().setCharacterEscapes(new HtmlCharacterEscapes());
        return new MappingJackson2HttpMessageConverter(objectMapper);
    }
}
```

#### í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ì ê¹! ğŸ˜
https://www.baeldung.com/spring-httpmessageconverter-rest ì— ë‚˜ì˜¨ ë§ì— ì˜í•˜ë©´

> If we're using Spring Boot we can avoid implementing the WebMvcConfigurer and adding all the Message Converters manually as we did above. <br>
We can just define different HttpMessageConverter beans in the context, and Spring Boot will add them automatically to the autoconfiguration that it creates:

<code>HttpMessageConverter</code>ë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ë ¤ë©´ <code>WebMvcConfigurer</code>ë¥¼ <code>implement</code>í•  í•„ìš”ê°€ ì—†ë‹¤ê³  í•œë‹¤.

<code>MappingJackson2HttpMessageConverter</code> ìœ„ë¡œ ê³„ì† ê°€ë‹¤ ë³´ë©´ <code>HttpMessageConverter</code>ê°€ ìˆë‹¤. <code>MappingJackson2HttpMessageConverter</code>ëŠ” <code>HttpMessageConverter</code>ì˜ ììììì‹ì´ë‹¤.

ì¦‰, Spring BootëŠ” <code>Jackson</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í¬í•¨í•˜ê³  ìˆì–´ì„œ ìë™ìœ¼ë¡œ <code>MappingJackson2HttpMessageConverter</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ JSONìœ¼ë¡œ ë³€í™˜í•œë‹¤. Spring Bootë¥¼ ì‚¬ìš©í•˜ë©´ <code>MappingJackson2HttpMessageConverter</code>ë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ë•Œ <code>WebMvcConfigurer</code>ë¥¼ <code>implement</code> í•  í•„ìš”ê°€ ì—†ë‹¤. í•´ë‹¹ beanì„ ì„ ì–¸ë§Œ í•´ì£¼ë©´ ëœë‹¤.

ê·¸ë˜ì„œ
```
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {

    @Bean
    public MappingJackson2HttpMessageConverter jsonEscapeConverter() {
        // MappingJackson2HttpMessageConverter Default ObjectMapper ì„¤ì • ë° ObjectMapper Config ì„¤ì •
        ObjectMapper objectMapper = Jackson2ObjectMapperBuilder.json().build();
        objectMapper.getFactory().setCharacterEscapes(new HtmlCharacterEscapes());
        return new MappingJackson2HttpMessageConverter(objectMapper);
    }
}
```
ì´ì²˜ëŸ¼ í•˜ì§€ ì•Šê³  í•´ë‹¹ <code>Bean</code> ë“±ë¡ë§Œ í•´ì¤˜ë„ ëœë‹¤ê³  í•œë‹¤.

#### ì´ëª¨ì§€ ì—ëŸ¬ ğŸ˜®â€ğŸ’¨
ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ í–ˆì„ ë•ŒëŠ” ì´ëª¨ì§€ê°€ ì—†ì–´ì„œ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ì´ ëë‹¤. í•˜ì§€ë§Œ ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸í•œ ë¶€ë¶„ì„ ì‹¤ì œ ë°°í¬ëœ ì„œë¹„ìŠ¤ì— ì ìš©í•˜ë ¤ê³  í–ˆì„ ë•Œ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤. ë°°í¬ëœ ì„œë¹„ìŠ¤ì—ëŠ” ì´ëª¨ì§€ê°€ ì‚¬ìš©ë˜ì–´ì„œ ì»¤ìŠ¤í„°ë§ˆì´ì§• ëœ <code>MappingJackson2HttpMessageConverter</code>ì— ì˜¤ë¥˜ê°€ ìˆì—ˆë˜ ê²ƒ ê°™ë‹¤.

<code>HTMLCharacterEscapes</code> í´ë˜ìŠ¤ì˜ <code>getEscapeSequence(int ch)</code> ë©”ì†Œë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•˜ë©´ ëœë‹¤.

```
@Override
public SerializableString getEscapeSequence(int ch) {
    SerializedString serializedString;
    char charAt = (char) ch;
    if (Character.isHighSurrogate(charAt) || Character.isLowSurrogate(charAt)) {
        StringBuilder sb = new StringBuilder();
        sb.append("\\u");
        sb.append(String.format("%04x", ch));
        serializedString = new SerializedString(sb.toString());
    } else {
        serializedString = new SerializedString(StringEscapeUtils.escapeHtml4(Character.toString(charAt)));
    }
    return serializedString;
}
```



> **ì°¸ê³ **
https://inseok9068.github.io/springboot/springboot-xss-response/ <br>
https://medium.com/@dltkdals2202/spring-boot-%EC%97%90%EC%84%9C-json-%ED%83%80%EC%9E%85-xss-prevention-e9ce7b02c05b <br>
https://www.adobe.io/experience-manager/reference-materials/6-5/javadoc/com/fasterxml/jackson/core/JsonpCharacterEscapes.html <br>
https://www.baeldung.com/spring-httpmessageconverter-rest