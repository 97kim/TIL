ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ë©´ **DI**(Dependency Injection), **IoC**(Inversion of Controll)ë¼ëŠ” ìš©ì–´ë¥¼ ë§ì´ ë“¤ì–´ë´¤ì„ ê²ƒì´ë‹¤.

**IoC(Inversion of Control, ì œì–´ì˜ ì—­ì „)**: í”„ë¡œê·¸ë¨ì˜ ì œì–´ íë¦„ì„ ì§ì ‘ ì œì–´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì™¸ë¶€ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒ, í”„ë ˆì„ì›Œí¬ëŠ” IoCë¼ëŠ” íŠ¹ì§•ì„ ê°–ëŠ”ë‹¤. í”„ë ˆì„ì›Œí¬ê°€ í”„ë¡œê·¸ë¨ì˜ íë¦„ì„ ì œì–´í•˜ê¸° ë•Œë¬¸!

**DI(Dependency Injection, ì˜ì¡´ê´€ê³„/ì˜ì¡´ì„± ì£¼ì…)**ë¼ëŠ” ê²ƒì€ ìŠ¤í”„ë§ì—ì„œë§Œ ì‚¬ìš©ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.

JAVAë¡œ ì˜ˆë¥¼ ë“¤ê² ë‹¤ !

## JAVA

### âœ… v1
#### Domain
```
public class Person {

    private Long id;
    private String name;
    private int age;

    public Person(Long id, String name, int age) {
        this.id = id;
        this.name = name;
        this.age = age;
    }
    
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
    
    @Override
    public String toString() {
        return "Person{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", age=" + age +
                '}';
    }
}
```

#### Repository
```
public class PersonRepository {

    private static Map<Long, Person> store = new HashMap<>();

    public void save(Person person) {
        store.put(person.getId(), person);
    }
}
```

> DIì— ì§‘ì¤‘í•˜ê¸° ìœ„í•´ DBì— ì €ì¥í•˜ì§€ ì•Šê³  HashMapì„ ì‚¬ìš©í–ˆë‹¤.
TMI- ì‹¤ë¬´ì—ì„œëŠ” HashMapì„ ì‚¬ìš©í•˜ë©´ ë™ì‹œì„± ì´ìŠˆê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ConcurrentHashMapì„ ì‚¬ìš©í•œë‹¤ê³  í•œë‹¤.
- ConcurrentHashMap: Hashtable í´ë˜ìŠ¤ì˜ ë‹¨ì ì„ ë³´ì™„í•˜ë©´ì„œ ë©€í‹° ì“°ë ˆë“œ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë‚˜ì˜¨ í´ë˜ìŠ¤

#### Service
```
public class PersonService {

    private final PersonRepository personRepository = new PersonRepoitory();

    public void join(Person person) {
        personRepository.save(person);
    }
}
```

#### Application
```
public class PersonApp {

    public static void main(String[] args) {
        PersonService personService = new PersonService();
        Person person = new Person(1L, "KJ", 25);
        personService.join(person);
        
        System.out.println(person.toString()); // Person{id=1, name='KJ', age=25}

    }
}
```

PersonService í´ë˜ìŠ¤ì—ì„œ PersonRepository í´ë˜ìŠ¤ ê°ì²´ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ë° PersonService í´ë˜ìŠ¤ì—ì„œ PersonRepository ê°ì²´ë¥¼ ìƒì„±í•˜ê²Œ ë˜ë©´ ì´ ë‘˜ ì‚¬ì´ì— ê°•í•œ ê²°í•©ì´ ë§ºì–´ì§„ë‹¤. ê²°í•©ë„ê°€ ê°•í•´ì§€ëŠ” ê±´ ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹ˆë‹¤. ê²°í•©ë„ëŠ” ë‚®ê²Œ, ì‘ì§‘ë„ëŠ” ë†’ê²Œ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ë°©ë²•ì´ë‹¤.

ê¸°ì¡´ì˜ ê°•ê²°í•©ì„ ìƒì„±ìë¥¼ í†µí•œ DIë¡œ ì•½í•˜ê²Œ ë§Œë“¤ì–´ë³´ì !

### âœ… v2

#### Domain
ìœ„ì™€ ê°™ìœ¼ë¯€ë¡œ ìƒëµ

#### Repository
ìœ„ì™€ ê°™ìœ¼ë¯€ë¡œ ìƒëµ

#### Service
```
public class PersonService {

    private final PersonRepository personRepository;

    public PersonService(PersonRepository personRepository) {
        this.personRepository = personRepository;
    }

    public void join(Person person) {
        personRepository.save(person);
    }
}
```

PersonService í´ë˜ìŠ¤ì˜ ìƒì„±ìë¥¼ ë§Œë“¤ì—ˆë‹¤. ìƒì„±ìë§Œ ë§Œë“¤ë©´ ì–´ë–¡í•˜ë¼ê³ ?? ì™¸ë¶€ì—ì„œ ë­ë¼ë„ ë„£ì–´ì¤˜ì•¼ ë˜ì§€ ì•Šë‚˜??
ê·¸ë ‡ë‹¤! AppConfig í´ë˜ìŠ¤ì—ì„œ ì£¼ì…ì‹œì¼œì¤„ ê²ƒì´ë‹¤.

#### ğŸ’‰ AppConfig ğŸ’‰
```
public class AppConfig {

    public PersonService personService() {
        return new PersonService(new PersonRepository());
    }

}
```

#### Application
```
public class PersonApp {

    public static void main(String[] args) {
    
        AppConfig appConfig = new AppConfig();
        PersonService personService = appConfig.personService();

        Person person = new Person(1L, "KJ", 25);

        personService.join(person);

        System.out.println(person.toString()); // Person{id=1, name='KJ', age=25}
        
    }
}
```

ì´ì²˜ëŸ¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì (ëŸ°íƒ€ì„)ì— ì™¸ë¶€(AppConfig í´ë˜ìŠ¤)ì—ì„œ ì‹¤ì œ êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ ì‹¤ì œ ì˜ì¡´ê´€ê³„ê°€ ì—°ê²° ë˜ëŠ” ê²ƒì„ **DI(ì˜ì¡´ê´€ê³„ ì£¼ì…)**ì´ë¼ í•œë‹¤.
ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ ì´ì „ì— ê°•í–ˆë˜ ê²°í•©ì´ ì•½í•´ì¡Œë‹¤ !!

<hr>

## Springìœ¼ë¡œ ì „í™˜

### AppConfig
```
@Configuration
public class AppConfig {

    @Bean  // Beanì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ì´ ëœë‹¤
    public PersonService personService() {
        return new PersonService(new PersonRepository());
    }

}
```
**@Configuration** ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•œë‹¤. í•˜ë‚˜ ì´ìƒì˜ **@Bean**ì„ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤ì˜ ê²½ìš°ì—ëŠ” **@Configuration**ì„ ë„£ëŠ”ë‹¤.
ìŠ¤í”„ë§ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ Bean ì´ë¦„ì€ ë©”ì„œë“œëª…(personService)ìœ¼ë¡œ ë“±ë¡ëœë‹¤.
**@Bean(name="ë¹ˆ ì´ë¦„")**ì„ í†µí•´ ì§ì ‘ ì´ë¦„ì„ ì •í•´ì¤„ ìˆ˜ë„ ìˆë‹¤.

### Application
```
public class PersonApp {

    public static void main(String[] args) {
    
        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);
        // AppConfig í´ë˜ìŠ¤ì˜ ë¹ˆì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡í•´ ê´€ë¦¬í•œë‹¤.
        PersonService personService = ac.getBean("personService", PersonService.class);
        // personServiceì´ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ë¹ˆì„ ê°€ì ¸ì™€ ë³€ìˆ˜ì— í• ë‹¹

        Person person = new Person(1L, "KJ", 25);

        personService.join(person);

        System.out.println(person.toString()); // Person{id=1, name='KJ', age=25}
        
    }
}
```

ìœ„ì—ì„œëŠ” Beanì„ ìë°” ì½”ë“œë¡œ ë“±ë¡í–ˆì§€ë§Œ xmlë¡œë„ ê°€ëŠ¥í•˜ë‹¤.

```
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="memberRepository" class="hello.core.member.MemoryMemberRepository" />
    
</beans>
```

ìœ„ ë°©ë²•ì²˜ëŸ¼ Beanì„ ì§ì ‘ ë“±ë¡í•´ë„ ë˜ì§€ë§Œ ì´ê²ƒë³´ë‹¤ ë” ê°„í¸í•˜ê²Œ **@Component, @ComponentScan** ì´ë¼ëŠ” ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ìŠ¤í”„ë§ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸°ë„ í•œë‹¤.
**@Controller, @Service, @Repository** ë“± ì—¬ëŸ¬ ì–´ë…¸í…Œì´ì…˜ì— **@Component**ê°€ í¬í•¨ë˜ì–´ ìˆê³  **@SpringBootApplication**ì— **@ComponentScan**ì´ í¬í•¨ë˜ì–´ ìˆë‹¤.

ê·¸ë˜ì„œ ìˆ˜ë™ì ìœ¼ë¡œ **@Bean**ì„ ë„£ì§€ ì•Šì•„ë„ **@Component, @ComponentScan** ì´ ë‘ ê°€ì§€ ì–´ë…¸í…Œì´ì…˜ì´ ìë™ìœ¼ë¡œ í•´ì¤€ë‹¤.

ê·¸ë¦¬ê³  ì˜ì¡´ê´€ê³„ ì£¼ì…ì€ **@Autowired**ë¡œ í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. **@Autowired**ë¥¼ ì‚¬ìš©í•˜ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìë™ìœ¼ë¡œ í•´ë‹¹ ìŠ¤í”„ë§ ë¹ˆì„ ì°¾ì•„ì„œ ì£¼ì…í•œë‹¤. ìƒì„±ì, Setter, í•„ë“œ, ì¼ë°˜ ë©”ì„œë“œë¥¼ í†µí•œ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ìˆì§€ë§Œ ìƒì„±ìë¥¼ í†µí•´ DIë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  í•œë‹¤.

ìŠ¤í”„ë§ì´ ì–´ë µì§€ë§Œ ìŠ¤í”„ë§ì— ëŒ€í•´ ì•Œë©´ ì•Œìˆ˜ë¡ ê°œë°œìë¥¼ ì—„ì²­ í¸í•˜ê²Œ í•´ì¤€ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤ !

> **ì°¸ê³ **
ì¸í”„ëŸ° ê¹€ì˜í•œë‹˜ ê°•ì˜, https://inf.run/bvKz
